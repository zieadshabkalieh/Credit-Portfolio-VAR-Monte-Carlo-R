# تثبيت واستدعاء الحزم اللازمة
# install.packages(c("tidyverse","ggridges"))
library(tidyverse)
library(ggridges)

# ١. تجميع البيانات في قائمة حسب السنة
loss_list <- list(
  2008 = c(401509.9799,450771.6916,424244.1152,352531.3815,331974.4711,
             343602.5624,253661.5716,392223.3292,382583.63,459565.8742,
             317213.7267,228980.5288,293386.305,352622.879,401255.9304,
             488521.9231,377175.3329,313042.6243,673953.5826,725837.929,
             467535.8162,843507.705,434555.4688,433824.8763),
  2009 = c(512388.8041,587443.1866,431400.1236,358631.1186,615429.4602,
             508525.8916,153445.0283,674990.4518,362846.6916,627583.542,
             808520.2577,383225.9087,305793.75,397529.5433,494946.7479,
             414402.589,455836.4415,529745.8523,838355.8866,346894.42,
             657099.1263,966132.4663,749230.6231,747108.9695),
  2010 = c(583128.2748,652295.6378,565211.202,340150.9541,666592.2395,
             628909.3058,159619.0744,870714.4991,384920.4858,647218.7653,
             833779.5468,793046.6959,329562.4891,462394.355,549918.2702,
             475606.0391,398397.8052,561502.8996,891203.4983,352694.0685,
             793045.0102,1032720.485,812012.6605,786680.2909),
  2011 = c(882888.3344,650214.0711,613874.3356,429258.5381,506367.0185,
             460383.8901,428924.8206,725425.1056,369966.948,690220.7588,
             602564.1514,411294.2612,409429.4653,626455.893,703139.23,
             728769.0298,508381.6176,488217.4358,799527.6182,809737.6003,
             629780.2579,815421.4916,702129.4093,604934.3403),
  2012 = c(1445371.456,1163802.904,1507769.751,695725.9926,1112849.053,
             971607.2678,585027.9899,1109932.96,487264.2213,1187416.522,
             1148741.552,1231735.214,1103292.669,1290191.321,1500441.327,
             1506865.063,797153.0198,1231696.741,1439877.48,873509.0342,
             996660.9655,1296690.568,1233536.728,1181810.526),
  2013 = c(785472.3198,676780.5836,993055.6915,586224.7409,637136.8286,
             483626.8595,465706.57,466167.5964,491689.9428,592739.1641,
             818990.3256,853728.4511,441616.5256,614264.2484,815825.665,
             802137.4313,724657.2404,421096.7334,649654.5798,929746.4411,
             618449.6932,1146042.035,735932.8544,930549.8377),
  2014 = c(918116.5333,786303.9696,1156545.85,569354.7727,662161.3516,
             706584.783,495899.2506,991953.6743,566536.6493,870203.5143,
             789580.9527,705846.2822,435648.4796,1086177.292,863513.6755,
             861076.3405,641345.4261,572445.1258,1140924.762,1018550.171,
             913449.5593,1284718.911,894927.2159,834321.5013),
  2015 = c(870289.492,725351.824,750118.3146,503862.8727,758121.5852,
             654871.1478,423818.0121,601575.036,875724.8454,830149.3946,
             922106.5209,880018.7659,559924.3705,956080.4417,748278.0246,
             766608.9607,610231.8931,569956.4547,1020400.299,669142.2224,
             751977.7544,1225348.106,927796.4997,962212.9895),
  2016 = c(688454.9425,600673.8092,585637.7484,385025.0858,663266.1604,
             500295.0252,300106.2052,414908.3732,335405.4957,594452.3106,
             879059.7642,787563.2539,433477.9289,568219.8628,668456.4154,
             691685.7259,449054.9575,632928.6482,705433.0498,507542.8913,
             513801.8592,859555.6238,740022.101,908188.3342),
  2017 = c(1049193.161,597656.9129,949282.8731,451450.7887,508709.9796,
             492583.7236,434046.4834,508715.3892,367267.6057,788357.6061,
             360928.7372,511736.7468,307618.6333,1008625.881,663507.1615,
             562908.345,515206.4617,465801.0028,958810.4037,489547.3163,
             456418.4206,617835.099,628492.712,406204.5771),
  2018 = c(826558.0453,679412.4155,1089702.835,547827.9696,560683.8434,
             575167.5048,507135.5912,727342.8871,965954.5136,808486.9725,
             478700.8157,510564.918,541561.3207,1017841.596,741536.6856,
             858595.2524,617281.4212,443869.7587,1059414.686,1107533.715,
             822368.9227,1274795.495,726090.9488,663679.8154),
2019 = c(1115821.151,874267.8062,978243.434,798110.3089,702505.2107,
             607947.2014,626987.7069,559250.4376,720275.5262,1270617.471,
             749433.739,590614.7541,479400.1779,1185937.495,808046.6156,
             672574.6209,1117411.977,651350.7552,1194873.358,682591.1043,
             627988.437,1019475.018,976908.9006,986253.0747),
  2020 = c(1574392.7,1312467.976,1616438.998,748380.4831,1611267.626,
             947746.2887,593424.984,1261389.935,868596.8964,1236812.682,
             1332861.999,1468629.449,1277915.018,1293553.358,1680443.35,
             1672538.945,891634.7659,1287018.176,1273214.736,1026114.993,
             1257809.462,1813544.168,1474257.063,1532728.342),
  2021 = c(653928.2254,657385.9439,671687.7202,345555.6448,716968.2581,
             543311.6999,265371.7913,925189.1098,872021.7262,622543.9347,
             897203.3831,858172.7047,538266.6769,598754.9523,667413.0056,
             637528.0019,460206.7146,540725.2079,637640.6342,532921.9437,
             929862.1104,1200925.5,858373.2082,945629.5244),
  2022 = c(1039556.834,859956.7031,914087.9888,541563.3123,669966.0837,
             593029.2292,536501.3296,979295.0509,805866.7164,1075150.685,
             621592.813,563396.4019,664130.89,1090694.401,1101317.484,
             1107660.057,736000.0054,552502.0038,906932.7869,847404.8382,
             915516.6492,1249753.745,963104.7933,803776.8128),
  2023 = c(956652.0382,757474.9772,1051872.685,609415.6347,579881.7676,
             567608.3563,527441.6532,515861.3967,501051.1909,1121464.441,
             468891.1902,493178.1361,458934.8323,1069055.538,711103.9398,
             793573.192,691045.8235,552250.5766,1131230.545,995863.2599,
             587969.3087,1099472.951,782696.059,582403.822)
)

# ٢. تحويل إلى إطار بيانات طويل
df_long <- imap_dfr(loss_list, ~ tibble(
  Year     = as.integer(.y),
  Scenario = seq_along(.x),
  Loss     = .x
))

# ٣. رسم Ridgeline Plot
ggplot(df_long, aes(x = Loss, y = factor(Year))) +
  geom_density_ridges(
    scale           = 2,
    rel_min_height  = 0.01,
    fill            = "grey70",
    color           = "black"
  ) +
  theme_ridges(font_size = 12) +
  scale_y_discrete(expand = c(0.01, 0)) +
  labs(
    title = "توزيع خسائر المحفظة الائتمانية عبر السنوات ٢٠٠٨–٢٠٢٣",
    x     = "قيمة الخسارة",
    y     = "السنة"
  )
